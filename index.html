<script>
function fmtDate(iso) {
  const d = new Date(iso);
  return d.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
}

async function loadRepos() {
  const user = "javieraespinozam";
  const grid = document.querySelector(".grid");
  if (!grid) return;

  // Opcional: si quieres ocultar las tarjetas “manuales”, descomenta:
  // grid.innerHTML = "";

  try {
    const res = await fetch(`https://api.github.com/users/${user}/repos?per_page=100&sort=updated`);
    if (!res.ok) throw new Error("GitHub API error " + res.status);
    const repos = await res.json();

    // Filtra lo que no quieres listar
    const filtered = repos
      .filter(r => !r.fork && !r.archived && r.name !== `${user}.github.io`)
      .sort((a,b) => new Date(b.pushed_at) - new Date(a.pushed_at)); // recientes primero

    // Render tarjetas
    for (const repo of filtered) {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div>
          <h3><a href="${repo.homepage || repo.html_url}" target="_blank" rel="noreferrer">${repo.name}</a></h3>
          <p>${repo.description ? repo.description : "No description available."}</p>
          <div class="meta">
            <span class="chip">⭐ ${repo.stargazers_count}</span>
            <span class="chip">Updated ${fmtDate(repo.updated_at)}</span>
            ${repo.language ? `<span class="chip">${repo.language}</span>` : ""}
          </div>
        </div>
        <a class="btn" href="${repo.html_url}" target="_blank" rel="noreferrer">Repository</a>
      `;
      grid.appendChild(card);
    }
  } catch (e) {
    console.error(e);
    const err = document.createElement("p");
    err.textContent = "Couldn’t load repositories (GitHub API). Try reloading.";
    grid.appendChild(err);
  }
}

// Espera a que exista el DOM
window.addEventListener("DOMContentLoaded", loadRepos);
</script>

